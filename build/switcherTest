#!/bin/bash

. switcher

let failedTests=0
testValue="testValue"

# test files will live in serets dir
testFile="../../secrets/secretsRegexTestFile"
resultsFile="${testFile}Result"

function runATest {
	replacePHPConfig "$configKey" "$testValue" "$resultsFile"
	testResult=$( { cat $resultsFile && echo "<?php echo $testValue ?>" ;}  | php )
	if [[ $testResult == $testValue ]]; then
		echo "Success - test result is $testResult"
	else
		echo "Failiure - test result is $testResult"
		((failedTests++))	
	fi
}

# Before
echo "get new results file (copying $testFile to $resultsFile)"
cp $testFile $resultsFile
echo "Refreshed $resultsFile - Do you want to run the tests? [y/n]" && read answer
if echo "$answer" | grep -q "^y" 
	then echo "continuing"
	else echo "exiting" && exit
fi

# Run tests
echo "Test Batch 1 - replace AdminSettings.php"
configKey="$wgDBadminpassword" 
runATest

# After
if (( $failedTests > 1 )); then 
	echo "Problems found, investigate"
else
	echo "All tests seemed to pass"
fi

