#! /bin/bash
# 
# basic build system for editing. 
# creds are kept above repo. 
# No flags gets us blank configs for repo

pathToSecrets="../../secrets"
mySQLDir="/Applications/MAMP/Library/bin"
db="q122303_qp"
sqlSaveDir="../../database"

function blankem {
echo "secrets blanked"
	cp class.database_blank.php ../includes/class.database.php
	cp AdminSettings_blank.php ../wiki/AdminSettings.php
	cp LocalSettings_blank.php ../wiki/LocalSettings.php
	cp wp-config_blank.php ../blog/wp-config.php
}

if [[ "$1" = "--local" ]]; then
	echo "local selected"
	cp $pathToSecrets/class.database_local.php ../includes/class.database.php
	cp $pathToSecrets/AdminSettings_local.php ../wiki/AdminSettings.php
	cp $pathToSecrets/LocalSettings_local.php ../wiki/LocalSettings.php
	cp $pathToSecrets/wp-config_local.php ../blog/wp-config.php

elif [[ "$1" = "--live" ]]; then
	echo "live selected"
	cp $pathToSecrets/class.database.php ../includes/class.database.php
	cp $pathToSecrets/AdminSettings.php ../wiki/AdminSettings.php
	cp $pathToSecrets/LocalSettings.php ../wiki/LocalSettings.php
	cp $pathToSecrets/wp-config.php ../blog/wp-config.php

elif [[ "$1" = "--exportSQL" ]]; then
	echo "exportSQL selected - press start server on MAMP!"
	open /Applications/MAMP/MAMP.app --args -AppCommandLineArg
	#wait 5 secs to give time to do that
	SECS=5
	while [[ 0 -ne $SECS ]]; do
    	echo "$SECS.."
    	sleep 1
    	SECS=$[$SECS-1]
	done
	echo "local MAMP MySQL password please:"
  	$mySQLDir/mysqldump -u root -p "$db" > "$sqlSaveDir/$db".sql
  	if [[ -f  "$sqlSaveDir/$db".sql ]]; then
  		echo "database exporting ok" 
  	else 
  		printf '%s not created!\n' "$sqlSaveDir/$db".sql
  	fi
  	exit
else
	echo "no flags"
	blankem	
fi

open -nW /Applications/MAMP/MAMP.app --args -AppCommandLineArg && {
  echo "shutting down and blanking"; 
  blankem; 
}
#And when we close, we go back to blank...





